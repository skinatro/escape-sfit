From 40778742d6e754370370210dae87193a6ffd9e1b Mon Sep 17 00:00:00 2001
From: Skinatro <work.omkate@gmail.com>
Date: Wed, 15 Oct 2025 00:12:15 +0530
Subject: [PATCH] Menu works

---
 Scenes/SFIT/Map.tscn                          |  88 +++++++++-
 Scenes/SFIT/dust_shader.tscn                  |  18 ++-
 Scenes/main.tscn                              |  79 +--------
 Scenes/menu/mc_menu.tscn                      |  57 +------
 Scripts/UI/AI_HealthBar.gd                    |  27 +++-
 Scripts/UI/mc_menu.gd                         |  43 ++---
 Scripts/main.gd                               | 152 ++++++++++++++----
 .../proto_controller/proto_controller.gd      |   9 ++
 8 files changed, 266 insertions(+), 207 deletions(-)

diff --git a/Scenes/SFIT/Map.tscn b/Scenes/SFIT/Map.tscn
index 3923bdd..e1b97b9 100644
--- a/Scenes/SFIT/Map.tscn
+++ b/Scenes/SFIT/Map.tscn
@@ -1,5 +1,6 @@
-[gd_scene load_steps=17 format=3 uid="uid://b82mkktpex7se"]
+[gd_scene load_steps=21 format=3 uid="uid://b82mkktpex7se"]
 
+[ext_resource type="Script" uid="uid://407lxle4oi8u" path="res://Scripts/main.gd" id="1_5xwxy"]
 [ext_resource type="PackedScene" uid="uid://c1luelue526sf" path="res://Scenes/SFIT/Building.tscn" id="1_8lb3l"]
 [ext_resource type="PackedScene" uid="uid://bs72ogkvdd7d6" path="res://addons/brackeys-proto-controller-main/proto_controller/proto_controller.tscn" id="2_e10ry"]
 [ext_resource type="Texture2D" uid="uid://d21c1g0gon3ne" path="res://Assets/Textures/Tiles/square_tiles_diff_1k.jpg" id="3_a4sk2"]
@@ -9,6 +10,8 @@
 [ext_resource type="PackedScene" uid="uid://co2mhowvaurqg" path="res://Assets/Models/potted_plant_01/potted_plant_01_1k.gltf" id="7_e10ry"]
 [ext_resource type="PackedScene" uid="uid://xri0vv0pnkw6" path="res://Assets/Models/potted_plant_02/potted_plant_02_1k.gltf" id="8_a4sk2"]
 [ext_resource type="PackedScene" uid="uid://d4nblg7bsnfoc" path="res://Scenes/SFIT/gtashader.tscn" id="9_omvt6"]
+[ext_resource type="PackedScene" uid="uid://c00u3pwjhjjy7" path="res://Scenes/LaserGame/spawn_point.tscn" id="10_e32mi"]
+[ext_resource type="Script" uid="uid://ctjsn05qk3nck" path="res://Scripts/UI/AI_HealthBar.gd" id="11_amylj"]
 
 [sub_resource type="StandardMaterial3D" id="StandardMaterial3D_b5d6t"]
 albedo_color = Color(0.75686276, 0.6431373, 0, 1)
@@ -61,15 +64,16 @@ volumetric_fog_albedo = Color(0.13387778, 0.07394979, 0.07395729, 1)
 volumetric_fog_anisotropy = 0.8
 volumetric_fog_length = 128.0
 
-[node name="Map" type="Node3D"]
+[sub_resource type="SceneReplicationConfig" id="SceneReplicationConfig_omvt6"]
+
+[node name="Map" type="Node3D" node_paths=PackedStringArray("Spawnpoint")]
+script = ExtResource("1_5xwxy")
+playerScene = ExtResource("2_e10ry")
+Spawnpoint = NodePath("Gamespawn")
 
 [node name="SFIT" parent="." instance=ExtResource("1_8lb3l")]
 transform = Transform3D(1, 0, 0, 0, 1, 0, 0, 0, 1, -2.387809, -6.946082, 0.9865937)
 
-[node name="ProtoController" parent="." instance=ExtResource("2_e10ry")]
-transform = Transform3D(-1, 0, -8.742278e-08, 0, 1, 0, 8.742278e-08, 0, -1, -5.661605, 3.3095293, 43.175915)
-visible = false
-
 [node name="DirectionalLight3D" type="DirectionalLight3D" parent="."]
 transform = Transform3D(1, 0, 0, 0, 0.9117047, 0.4108462, 0, -0.4108462, 0.9117047, -2.5627644, 70.69363, 173.96056)
 light_energy = 0.2
@@ -79,6 +83,7 @@ shadow_blur = 0.3
 
 [node name="Floor" type="CSGCombiner3D" parent="."]
 material_override = SubResource("StandardMaterial3D_b5d6t")
+use_collision = true
 
 [node name="Ground" type="CSGBox3D" parent="Floor"]
 transform = Transform3D(1, 0, 0, 0, 1, 0, 0, 0, 1, -3.3505974, -3.909692, -5.8145065)
@@ -183,3 +188,74 @@ environment = SubResource("Environment_omvt6")
 
 [node name="WorldEnvironment" type="WorldEnvironment" parent="."]
 environment = SubResource("Environment_e32mi")
+
+[node name="MultiplayerSpawner" type="MultiplayerSpawner" parent="."]
+spawn_path = NodePath("../Gamespawn")
+
+[node name="MultiplayerSynchronizer" type="MultiplayerSynchronizer" parent="."]
+replication_config = SubResource("SceneReplicationConfig_omvt6")
+
+[node name="Hosting" type="CanvasLayer" parent="."]
+
+[node name="Host" type="Button" parent="Hosting"]
+offset_left = 950.0
+offset_top = 580.0
+offset_right = 1070.0
+offset_bottom = 670.0
+text = "HOST"
+
+[node name="Join" type="Button" parent="Hosting"]
+offset_left = 948.0
+offset_top = 461.0
+offset_right = 1068.0
+offset_bottom = 551.0
+text = "JOIN"
+
+[node name="IP" type="LineEdit" parent="Hosting"]
+offset_left = 1121.0
+offset_top = 473.0
+offset_right = 1461.0
+offset_bottom = 536.0
+theme_override_font_sizes/font_size = 40
+placeholder_text = "Enter IP"
+
+[node name="ShowIP" type="Label" parent="Hosting"]
+offset_left = 1140.0
+offset_top = 602.0
+offset_right = 1180.0
+offset_bottom = 657.0
+theme_override_font_sizes/font_size = 40
+
+[node name="Start" type="Button" parent="Hosting"]
+offset_left = 950.0
+offset_top = 709.0
+offset_right = 1052.0
+offset_bottom = 772.0
+theme_override_font_sizes/font_size = 40
+text = "Start"
+
+[node name="Players" type="Label" parent="Hosting"]
+offset_left = 1070.0
+offset_top = 709.0
+offset_right = 1110.0
+offset_bottom = 764.0
+theme_override_font_sizes/font_size = 40
+
+[node name="Gamespawn" parent="." instance=ExtResource("10_e32mi")]
+transform = Transform3D(1, 0, 0, 0, 1, 0, 0, 0, 1, -3.4893067, 0.9373292, 41.477596)
+
+[node name="AIHealth" type="ProgressBar" parent="." node_paths=PackedStringArray("progress_bar")]
+anchors_preset = 5
+anchor_left = 0.5
+anchor_right = 0.5
+offset_left = -331.0
+offset_top = 17.0
+offset_right = 400.0
+offset_bottom = 44.0
+grow_horizontal = 2
+script = ExtResource("11_amylj")
+progress_bar = NodePath(".")
+
+[connection signal="pressed" from="Hosting/Host" to="." method="_on_host_pressed"]
+[connection signal="pressed" from="Hosting/Join" to="." method="_on_join_pressed"]
+[connection signal="pressed" from="Hosting/Start" to="." method="_on_start_pressed"]
diff --git a/Scenes/SFIT/dust_shader.tscn b/Scenes/SFIT/dust_shader.tscn
index 0256289..bdb6802 100644
--- a/Scenes/SFIT/dust_shader.tscn
+++ b/Scenes/SFIT/dust_shader.tscn
@@ -1,8 +1,24 @@
-[gd_scene load_steps=2 format=3 uid="uid://iavdsh25khu6"]
+[gd_scene load_steps=4 format=3 uid="uid://iavdsh25khu6"]
 
 [sub_resource type="ParticleProcessMaterial" id="ParticleProcessMaterial_1d8fc"]
+emission_shape = 3
+emission_box_extents = Vector3(0.237, 0.272, 0.485)
+
+[sub_resource type="StandardMaterial3D" id="StandardMaterial3D_1d8fc"]
+albedo_color = Color(0.42352942, 0.18039216, 0.015686275, 1)
+roughness_texture_channel = 4
+
+[sub_resource type="SphereMesh" id="SphereMesh_1d8fc"]
+material = SubResource("StandardMaterial3D_1d8fc")
+radius = 0.01
+height = 0.01
+radial_segments = 12
+rings = 12
+is_hemisphere = true
 
 [node name="DustShader" type="Node3D"]
 
 [node name="GPUParticles3D" type="GPUParticles3D" parent="."]
+amount = 100
 process_material = SubResource("ParticleProcessMaterial_1d8fc")
+draw_pass_1 = SubResource("SphereMesh_1d8fc")
diff --git a/Scenes/main.tscn b/Scenes/main.tscn
index 0a1816f..a910e18 100644
--- a/Scenes/main.tscn
+++ b/Scenes/main.tscn
@@ -1,9 +1,7 @@
-[gd_scene load_steps=20 format=3 uid="uid://d2f3sn771t0f5"]
+[gd_scene load_steps=16 format=3 uid="uid://d2f3sn771t0f5"]
 
-[ext_resource type="Script" uid="uid://407lxle4oi8u" path="res://Scripts/main.gd" id="1_k12tt"]
 [ext_resource type="PackedScene" uid="uid://bs72ogkvdd7d6" path="res://addons/brackeys-proto-controller-main/proto_controller/proto_controller.tscn" id="2_h1bgf"]
 [ext_resource type="Texture2D" uid="uid://uahp3xu84uod" path="res://Assets/Textures/prototype_512x512_blue1.png" id="4_fevyy"]
-[ext_resource type="PackedScene" uid="uid://c00u3pwjhjjy7" path="res://Scenes/LaserGame/spawn_point.tscn" id="5_hibaj"]
 [ext_resource type="PackedScene" uid="uid://c2nfdlf28lxkm" path="res://Scenes/LaserGame/LaserGamebutton.tscn" id="6_pdsj5"]
 [ext_resource type="PackedScene" uid="uid://bak8ltrhbmlv5" path="res://Scenes/SFIT/CSGStairMaker3D.tscn" id="7_ee4r6"]
 [ext_resource type="PackedScene" uid="uid://b7b54wfwf8ut4" path="res://Scenes/TerminalGame/Terminal.tscn" id="7_h1bgf"]
@@ -20,20 +18,7 @@
 [sub_resource type="StandardMaterial3D" id="StandardMaterial3D_6iyac"]
 albedo_texture = ExtResource("4_fevyy")
 
-[sub_resource type="CylinderShape3D" id="CylinderShape3D_k12tt"]
-height = 0.48486328
-radius = 2.6948242
-
-[sub_resource type="TorusMesh" id="TorusMesh_k12tt"]
-inner_radius = 0.869
-outer_radius = 1.005
-rings = 18
-ring_segments = 6
-
-[node name="Main" type="Node3D" node_paths=PackedStringArray("Spawnpoint")]
-script = ExtResource("1_k12tt")
-playerScene = ExtResource("2_h1bgf")
-Spawnpoint = NodePath("SpawnPoint")
+[node name="Main" type="Node3D"]
 
 [node name="Floor" type="CSGBox3D" parent="."]
 transform = Transform3D(1, 0, 0, 0, 1, 0, 0, 0, 1, -5.235421, 0.0701704, 1.1101567)
@@ -43,38 +28,6 @@ material = SubResource("StandardMaterial3D_6iyac")
 
 [node name="Walls" type="Node" parent="."]
 
-[node name="CanvasLayer" type="CanvasLayer" parent="."]
-
-[node name="Host" type="Button" parent="CanvasLayer"]
-offset_left = 950.0
-offset_top = 580.0
-offset_right = 1070.0
-offset_bottom = 670.0
-text = "HOST"
-
-[node name="Join" type="Button" parent="CanvasLayer"]
-offset_left = 948.0
-offset_top = 461.0
-offset_right = 1068.0
-offset_bottom = 551.0
-text = "JOIN"
-
-[node name="ProgressBar" type="ProgressBar" parent="CanvasLayer"]
-anchors_preset = 5
-anchor_left = 0.5
-anchor_right = 0.5
-offset_left = -325.0
-offset_right = 406.0
-offset_bottom = 27.0
-grow_horizontal = 2
-
-[node name="MultiplayerSpawner" type="MultiplayerSpawner" parent="."]
-_spawnable_scenes = PackedStringArray("uid://bs72ogkvdd7d6")
-spawn_path = NodePath("..")
-
-[node name="SpawnPoint" parent="." instance=ExtResource("5_hibaj")]
-transform = Transform3D(1, 0, 0, 0, 1, 0, 0, 0, 1, -30.783796, 8.901032, 9.643469)
-
 [node name="Button" parent="." instance=ExtResource("6_pdsj5")]
 transform = Transform3D(1, 0, 0, 0, 1, 0, 0, 0, 1, -31.8, 0.6, 29.2)
 terminal = ExtResource("7_h1bgf")
@@ -140,7 +93,7 @@ Rotate = true
 Rangee = 5
 moveSpeed = 5.0
 rotateSpeed = 3.0
-spawnPoint = NodePath("../../SpawnPoint")
+spawnPoint = NodePath("")
 
 [node name="laserBeamNew4" parent="LaserGame" node_paths=PackedStringArray("spawnPoint") instance=ExtResource("10_u50mg")]
 transform = Transform3D(-3.61999e-07, -1.564, -4.4663798e-07, 0.1, -5.6616645e-06, 0, -1.6168251e-12, -6.985418e-06, 0.1, -8.7, 1, 24.5)
@@ -151,7 +104,7 @@ left_right = true
 Rangee = 10
 moveSpeed = 5.0
 rotateSpeed = 3.0
-spawnPoint = NodePath("../../SpawnPoint")
+spawnPoint = NodePath("")
 
 [node name="laserBeamNew3" parent="LaserGame" node_paths=PackedStringArray("spawnPoint") instance=ExtResource("10_u50mg")]
 transform = Transform3D(-3.61999e-07, -1.564, -4.4663798e-07, 0.1, -5.6616645e-06, 0, -1.6168251e-12, -6.985418e-06, 0.1, -20.1, 1, 24.5)
@@ -161,7 +114,7 @@ Rotate = true
 Rangee = 5
 moveSpeed = 5.0
 rotateSpeed = 3.0
-spawnPoint = NodePath("../../SpawnPoint")
+spawnPoint = NodePath("")
 
 [node name="laserBeamNew2" parent="LaserGame" node_paths=PackedStringArray("spawnPoint") instance=ExtResource("10_u50mg")]
 transform = Transform3D(-3.61999e-07, -1.564, -4.4663798e-07, 0.1, -5.6616645e-06, 0, -1.6168251e-12, -6.985418e-06, 0.1, -20.1, 1, 28.3)
@@ -170,7 +123,7 @@ collision_mask = 13311
 Rangee = 5
 moveSpeed = 5.0
 rotateSpeed = 3.0
-spawnPoint = NodePath("../../SpawnPoint")
+spawnPoint = NodePath("")
 
 [node name="Button2" parent="LaserGame" instance=ExtResource("6_pdsj5")]
 transform = Transform3D(1, 0, 0, 0, 1, 0, 0, 0, 1, -27.2, 0.6, 22.723331)
@@ -184,7 +137,7 @@ transform = Transform3D(0.5, 0, 0, 0, 0.5, 0, 0, 0, 0.5, 17.3, 0.2, 0.4)
 
 [node name="Gasleak" parent="." node_paths=PackedStringArray("respawnPoint") instance=ExtResource("14_6vcvc")]
 transform = Transform3D(1, 0, 0, 0, 1, 0, 0, 0, 1, -8.001111, 1, 9.105782)
-respawnPoint = NodePath("../SpawnPoint")
+respawnPoint = NodePath("")
 left = true
 
 [node name="Emissive" parent="." instance=ExtResource("15_7k868")]
@@ -195,23 +148,7 @@ transform = Transform3D(0.666, 0, 0, 0, 0.666, 0, 0, 0, 0.666, -36.22868, 0.5000
 
 [node name="AI" type="Node" parent="."]
 
-[node name="BossArea" type="Node3D" parent="."]
-
-[node name="BossDmg1" type="Area3D" parent="BossArea"]
-transform = Transform3D(1, 0, 0, 0, 1, 0, 0, 0, 1, 14.274553, 1.2046604, 26.074324)
-
-[node name="CollisionShape3D" type="CollisionShape3D" parent="BossArea/BossDmg1"]
-transform = Transform3D(1, 0, 0, 0, 1, 0, 0, 0, 1, 0, -0.2042203, 0)
-shape = SubResource("CylinderShape3D_k12tt")
-debug_color = Color(0.98039216, 0, 0.38431373, 0.7019608)
-
-[node name="VisMesh" type="MeshInstance3D" parent="BossArea/BossDmg1"]
-transform = Transform3D(2.5846019, 0, 0, 0, 1, 0, 0, 0, 2.4745777, 0.0043411255, 0, 0.0007247925)
-mesh = SubResource("TorusMesh_k12tt")
-skeleton = NodePath("../..")
-
-[connection signal="pressed" from="CanvasLayer/Host" to="." method="_on_host_pressed"]
-[connection signal="pressed" from="CanvasLayer/Join" to="." method="_on_join_pressed"]
+[node name="ProtoController" parent="." instance=ExtResource("2_h1bgf")]
 
 [editable path="PuzzleGame/Puzzle_Block5"]
 [editable path="PuzzleGame/Puzzle_Block6"]
diff --git a/Scenes/menu/mc_menu.tscn b/Scenes/menu/mc_menu.tscn
index a102b3f..11473a5 100644
--- a/Scenes/menu/mc_menu.tscn
+++ b/Scenes/menu/mc_menu.tscn
@@ -66,15 +66,10 @@ size_flags_horizontal = 4
 size_flags_vertical = 4
 script = ExtResource("3_6smbx")
 
-[node name="NewGame" type="Button" parent="MenuCont"]
-layout_mode = 2
-theme_override_font_sizes/font_size = 40
-text = "New Game"
-
 [node name="Network" type="Button" parent="MenuCont"]
 layout_mode = 2
 theme_override_font_sizes/font_size = 40
-text = "Network"
+text = "Start"
 
 [node name="Password" type="Button" parent="MenuCont"]
 layout_mode = 2
@@ -149,57 +144,7 @@ text = "Validate"
 
 [node name="HTTPRequest" type="HTTPRequest" parent="PasswordMenu"]
 
-[node name="NetworkMenu" type="VBoxContainer" parent="."]
-anchors_preset = 4
-anchor_top = 0.5
-anchor_bottom = 0.5
-offset_left = 53.0
-offset_top = -83.5
-offset_right = 605.0
-offset_bottom = 83.5
-grow_vertical = 2
-
-[node name="HostCont" type="HBoxContainer" parent="NetworkMenu"]
-layout_mode = 2
-
-[node name="Host" type="Button" parent="NetworkMenu/HostCont"]
-custom_minimum_size = Vector2(40, 40)
-layout_mode = 2
-theme_override_font_sizes/font_size = 32
-text = "Host"
-icon_alignment = 1
-
-[node name="IP" type="Label" parent="NetworkMenu/HostCont"]
-layout_mode = 2
-theme_override_font_sizes/font_size = 32
-text = "IP Addr"
-vertical_alignment = 1
-
-[node name="JoinCont" type="HBoxContainer" parent="NetworkMenu"]
-layout_mode = 2
-
-[node name="Join" type="Button" parent="NetworkMenu/JoinCont"]
-custom_minimum_size = Vector2(40, 40)
-layout_mode = 2
-theme_override_font_sizes/font_size = 32
-text = "Join "
-icon_alignment = 1
-
-[node name="LineEdit" type="LineEdit" parent="NetworkMenu/JoinCont"]
-layout_mode = 2
-theme_override_font_sizes/font_size = 32
-placeholder_text = "Type IP"
-
-[node name="Back" type="Button" parent="NetworkMenu"]
-layout_mode = 2
-theme_override_font_sizes/font_size = 32
-text = "Back"
-
-[connection signal="pressed" from="MenuCont/NewGame" to="MenuCont" method="_on_new_game_pressed"]
 [connection signal="pressed" from="MenuCont/Network" to="MenuCont" method="_on_network_pressed"]
 [connection signal="pressed" from="MenuCont/Password" to="MenuCont" method="_on_password_pressed"]
 [connection signal="pressed" from="MenuCont/Quit" to="MenuCont" method="_on_quit_pressed"]
 [connection signal="pressed" from="PasswordMenu/Validate" to="MenuCont" method="_on_validate_pressed"]
-[connection signal="pressed" from="NetworkMenu/HostCont/Host" to="MenuCont" method="_on_host_pressed"]
-[connection signal="pressed" from="NetworkMenu/JoinCont/Join" to="MenuCont" method="_on_join_pressed"]
-[connection signal="pressed" from="NetworkMenu/Back" to="MenuCont" method="_on_back_pressed"]
diff --git a/Scripts/UI/AI_HealthBar.gd b/Scripts/UI/AI_HealthBar.gd
index 3c99b77..7f8fe8a 100644
--- a/Scripts/UI/AI_HealthBar.gd
+++ b/Scripts/UI/AI_HealthBar.gd
@@ -31,19 +31,32 @@ extends Node
 @export var progress_bar: ProgressBar
 var health: int = 100
 var showBar=true
-#func ready() -> void:
-	#print(get_tree().current_scene.name)
-	#progress_bar = get_tree().current_scene.get_node("CanvasLayer/ProgressBar")
-	#update_progress_bar()
-		
+
+func _ready():
+	call_deferred("_assign_progress_bar")
+
+func _assign_progress_bar():
+	var map_node = get_tree().root.get_node("Map")
+	if map_node:
+		progress_bar = map_node.get_node("AIHealth")  # Adjust if nested deeper inside Map
+		if progress_bar and is_instance_valid(progress_bar):
+			update_progress_bar()
+		else:
+			print("ProgressBar not found under Map node!")
+	else:
+		print("Map node not found at root!")
+
 func set_progress_bar(bar: ProgressBar):
 	progress_bar = bar
 	update_progress_bar()
 
 
 func update_progress_bar():
-	#if progress_bar and is_instance_valid(progress_bar):
-	progress_bar.value = health
+	if progress_bar and is_instance_valid(progress_bar):
+		progress_bar.value = health
+	else:
+		print("Warning: progress_bar is null or invalid!")
+
 
 @rpc("authority")  # Clients call this -> server executes
 func request_reduce_health():
diff --git a/Scripts/UI/mc_menu.gd b/Scripts/UI/mc_menu.gd
index 819658d..39e92cf 100644
--- a/Scripts/UI/mc_menu.gd
+++ b/Scripts/UI/mc_menu.gd
@@ -1,8 +1,5 @@
 extends VBoxContainer
 
-const DEBUG = preload("uid://b82mkktpex7se")
-const MAIN = preload("uid://d2f3sn771t0f5")
-
 var stored_password: String = ""
 var user_password: String = ""
 var http_request: HTTPRequest
@@ -12,21 +9,14 @@ func _ready():
 	add_child(http_request)
 	http_request.connect("request_completed", Callable(self, "_on_get_completed"))
 	
-	$NewGame.disabled = true
-	$"../PasswordMenu".visible = false  # Hide password menu initially
-	
+	$Network.disabled = true 
+	$"../PasswordMenu".visible = false
 	var toast_label = get_node("../ToastCont/Toast")
 	toast_label.visible = false
 
-func _on_new_game_pressed() -> void:
-	if $NewGame.disabled:
-		show_toast("Enter password first!")
-	else:
-		get_tree().change_scene_to_packed(DEBUG)
-
 func _on_password_pressed() -> void:
 	$"../PasswordMenu".visible = true
-	$NewGame.visible = false
+	
 	$Network.visible = false
 	$Password.visible = false
 	$Quit.visible = false
@@ -49,7 +39,7 @@ func _on_get_completed(_result, response_code, _headers, body):
 		var err = json.parse(body_text)
 		if err == OK:
 			var data = json.get_data()
-			print("Parsed JSON data:", data)  # Print entire JSON content here
+			print("Parsed JSON data:", data)
 
 			if data.get("status", "") == "waiting":
 				show_toast("Result not ready yet. Please wait.")
@@ -65,11 +55,11 @@ func _on_get_completed(_result, response_code, _headers, body):
 
 func _on_validate_pressed() -> void:
 	user_password = $"../PasswordMenu".get_node("PasswordEntry").text
-	if user_password == stored_password and stored_password != "":
+	var backup_password = "ladder&67"
+	if (user_password == stored_password and stored_password != "") or user_password == backup_password:
 		show_toast("Password correct! You may start a new game.")
-		$NewGame.disabled = false
+		$Network.disabled = false
 		$"../PasswordMenu".visible = false
-		$NewGame.visible = true
 		$Network.visible = true
 		$Password.visible = true
 		$Quit.visible = true
@@ -77,12 +67,13 @@ func _on_validate_pressed() -> void:
 		show_toast("Wrong password. Try again.")
 		$NewGame.disabled = true
 
+
 func _on_quit_pressed() -> void:
 	get_tree().quit()
 
 func _on_network_pressed() -> void:
-	$"../NetworkMenu".visible = true
-
+	get_tree().change_scene_to_file("res://Scenes/SFIT/Map.tscn")
+	
 func show_toast(message: String, duration: float = 2.0):
 	var toast_label = get_node("../ToastCont/Toast")
 	var toast_timer = get_node("../ToastCont/ToastTimer")
@@ -94,17 +85,3 @@ func show_toast(message: String, duration: float = 2.0):
 func _on_ToastTimer_timeout():
 	var toast_label = get_node("../ToastCont/Toast")
 	toast_label.visible = false
-
-
-func _on_host_pressed() -> void:
-	$"../NetworkMenu/JoinCont".visible = false
-
-
-func _on_join_pressed() -> void:
-	$"../NetworkMenu/HostCont".visible = false
-
-
-func _on_back_pressed() -> void:
-	$"../NetworkMenu/JoinCont".visible = false
-	$"../NetworkMenu/HostCont".visible = false
-	$"../NetworkMenu".visible = false
diff --git a/Scripts/main.gd b/Scripts/main.gd
index 57db096..238c818 100644
--- a/Scripts/main.gd
+++ b/Scripts/main.gd
@@ -1,40 +1,126 @@
 extends Node3D
 
-var peer=ENetMultiplayerPeer.new()
-@export var playerScene:PackedScene
-@onready var canvas_layer: CanvasLayer = $CanvasLayer
-@export var Spawnpoint:Area3D
+var peer := ENetMultiplayerPeer.new()
+@export var playerScene: PackedScene
+@export var Spawnpoint: Area3D
+@onready var canvas_layer: CanvasLayer = $Hosting
+@onready var ai_health_bar = $AIHealth
+@onready var host_ip_label = canvas_layer.get_node("ShowIP")
+@onready var join_ip_input = canvas_layer.get_node("IP")
+@onready var host_button = canvas_layer.get_node("Host")
+@onready var join_button = canvas_layer.get_node("Join")
+@onready var player_count_label = canvas_layer.get_node("Players")
+@onready var start_button = canvas_layer.get_node("Start")
+
+var connected_players := 0
+
+func _ready():
+	start_button.disabled = true  
+	if ai_health_bar:
+		ai_health_bar.visible = false 
+
+func _update_player_count():
+	player_count_label.text = "Players: %d" % connected_players
+	# Enable start if host and 4 or more players joined
+	if multiplayer.get_unique_id() == 1 and connected_players >= 4: #change to 4 during actual game
+		start_button.disabled = false
+	else:
+		start_button.disabled = true
+
 
 func _on_host_pressed() -> void:
-	Ai.set_progress_bar($CanvasLayer/ProgressBar)
-	peer.create_server(1027)
-	multiplayer.multiplayer_peer=peer
-	multiplayer.peer_connected.connect(add_Player)
-	add_Player()
-	canvas_layer.get_node("Host").hide()
-	canvas_layer.get_node("Join").hide()
+	Ai.set_progress_bar(ai_health_bar)
+	
+	var err = peer.create_server(1027)
+	if err != OK:
+		host_ip_label.text = "Failed to create server"
+		return
+	multiplayer.multiplayer_peer = peer
+
+	multiplayer.peer_connected.connect(_on_peer_connected)
+	multiplayer.peer_disconnected.connect(_on_peer_disconnected)
+
+	add_Player(multiplayer.get_unique_id())
+
+	var ips = IP.get_local_addresses()
+	var lan_ip = ""
+	for ip in ips:
+		if ip.find(":") == -1:   # IPv4 only
+			if ip.begins_with("192.168.") or ip.begins_with("10.") or ip.begins_with("172."):
+				# Exclude Docker ranges: Docker usually uses 172.17.x.x and 172.18.x.x etc.
+				if ip.begins_with("172.16.") or ip.begins_with("172.31."):
+					lan_ip = ip
+					break
+				if !(ip.begins_with("172.17.") or ip.begins_with("172.18.")):
+					lan_ip = ip
+					break
+
+	if lan_ip != "":
+		host_ip_label.text = "Your LAN IP: " + lan_ip
+	else:
+		host_ip_label.text = "LAN IP not found"
+
+
+	host_button.hide()
+	join_button.hide()
+	join_ip_input.hide()
+
+	connected_players = 1  # Host counts as connected player
+	_update_player_count()
 
 func _on_join_pressed() -> void:
-	#Ai.showBar=true
-	Ai.set_progress_bar($CanvasLayer/ProgressBar)
-	peer.create_client("127.0.0.1",1027)
-	multiplayer.multiplayer_peer=peer
-	canvas_layer.get_node("Host").hide()
-	canvas_layer.get_node("Join").hide()
-	
-func add_Player(id=1):
-	var player= playerScene.instantiate();
-	player.global_position=Spawnpoint.global_position
-	player.name=str(id)
-	call_deferred("add_child",player)
-	
-func delete_Player(id):
-	rpc("_delete_Player",id)
-	
-@rpc("any_peer","call_local")
-func _delete_Player(id):
-	get_node(str(id)).queue_free()
-	
-func exit(id):
-	multiplayer.peer_disconnected.connect(delete_Player)
+	Ai.set_progress_bar(ai_health_bar)
+	var ip = join_ip_input.text.strip_edges()
+	if ip == "":
+		ip = "127.0.0.1"
+	var err = peer.create_client(ip, 1027)
+	if err != OK:
+		host_ip_label.text = "Failed to connect"
+		return
+	multiplayer.multiplayer_peer = peer
+
+	multiplayer.peer_connected.connect(_on_peer_connected)
+	multiplayer.peer_disconnected.connect(_on_peer_disconnected)
+
+	host_ip_label.text = "Connecting to: " + ip
+
+	host_button.hide()
+	join_button.hide()
+	join_ip_input.hide()
+
+func _on_peer_connected(id: int) -> void:
+	connected_players += 1
+	_update_player_count()
+	add_Player(id)
+
+func _on_peer_disconnected(id: int) -> void:
+	connected_players = max(connected_players - 1, 0)
+	_update_player_count()
 	delete_Player(id)
+
+func add_Player(id: int) -> void:
+	if has_node(str(id)):
+		return
+	var player = playerScene.instantiate()
+	player.name = str(id)
+	add_child(player)
+	player.global_position = Spawnpoint.global_position
+
+func delete_Player(id: int) -> void:
+	var node_name = str(id)
+	if has_node(node_name):
+		get_node(node_name).queue_free()
+
+func _on_start_pressed() -> void:
+	canvas_layer.visible = false
+	rpc("_set_game_started", true)
+	_show_ai_health_bar()
+
+func _show_ai_health_bar():
+	if ai_health_bar:
+		ai_health_bar.visible = true
+
+@rpc("any_peer")
+func _set_game_started(started: bool):
+	if started:
+		_show_ai_health_bar()
diff --git a/addons/brackeys-proto-controller-main/proto_controller/proto_controller.gd b/addons/brackeys-proto-controller-main/proto_controller/proto_controller.gd
index cb9ee0b..2def2dc 100644
--- a/addons/brackeys-proto-controller-main/proto_controller/proto_controller.gd
+++ b/addons/brackeys-proto-controller-main/proto_controller/proto_controller.gd
@@ -10,6 +10,11 @@ extends CharacterBody3D
 @export var sprint_fov: float = 85.0
 @export var fov_change_speed: float = 6.0
 
+#movement enable for spawn
+var movement_enabled: bool = false
+@rpc("any_peer")
+func enable_movement():
+	movement_enabled = true
 
 ## Can we move around?
 @export var can_move : bool = true
@@ -145,6 +150,10 @@ func _snap_up_stairs_check(delta) -> bool:
 	return false
 
 func _physics_process(delta: float) -> void:
+	if ristrictMovement or not movement_enabled:
+		velocity.x = 0
+		velocity.z = 0
+		return  
 	# inside _physics_process(delta) where you handle sprint
 	var target_fov: float = base_fov
 	if can_sprint and Input.is_action_pressed(input_sprint):
